[save_variables]
filename: ~/klipper/vars.cfg

[filament_motion_sensor extruder_sensor]
extruder: extruder
detection_length: 14.0
event_delay: 120.0
switch_pin: PG14
pause_on_runout: False
runout_gcode:
    {% if printer.virtual_sdcard.is_active %}
        PAUSE
    {% endif %}
    FILAMENT_ERROR EXTRUDER=extruder

[filament_motion_sensor extruder1_sensor]
extruder: extruder1
detection_length: 14.0
event_delay: 120.0
switch_pin: PG15
pause_on_runout: False
runout_gcode:
    {% if printer.virtual_sdcard.is_active %}
        PAUSE
    {% endif %}
    FILAMENT_ERROR EXTRUDER=extruder1

[gcode_macro FILAMENT_ERROR]
gcode:
    {% if params.EXTRUDER == 'extruder' %}
        {action_raise_error('Filament error on Extruder 1')}
    {% else %}
        {action_raise_error('Filament error on Extruder 2')}
    {% endif %}


[gcode_macro SET_FILAMENT_SENSOR]
rename_existing: SET_FILAMENT_SENSOR_BASE
gcode:
    SET_FILAMENT_SENSOR_BASE SENSOR={params.SENSOR} ENABLE={params.ENABLE}
    SAVE_VARIABLE VARIABLE='filament_motion_sensor_{params.SENSOR}' VALUE={params.ENABLE}

