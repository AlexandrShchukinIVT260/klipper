[gcode_button five_axis_module]
pin: !P1.23
press_gcode: QUERY_BUTTON BUTTON=five_axis_module

[a_axis_offset]

[gcode_macro INSERT_CALIBRATION_TOOL]
gcode:
    G28
    G0 Z150

[gcode_macro MOVE_WCS_ZERO]
gcode:
    G54
    G0 Z150
    {% set current_wcs = params.WCS|default(1)|int %}
    {% set offsets = printer.gcode_move.wcs_offsets[current_wcs] %}
    {% if offsets[0] == 0 and offsets[1] == 0 %}
        G0 X107 Y157
    {% else %}
        G0 X{offsets[0]} Y{offsets[1]}
    {% endif %}
    {% if current_wcs == 1 %}
        G0 A0
    {% elif current_wcs == 2 %}
        G0 A90
    {% endif %}

[gcode_macro SET_WCS_OFFSET]
gcode:
    {% set current_wcs = params.WCS|default(1)|int %}
    {% set adjust_wcs = params.ADJUST_WCS|default(0)|int %}
    {% if adjust_wcs > 0 and adjust_wcs != current_wcs %}
        {% set offsets = printer.gcode_move.wcs_offsets[adjust_wcs] %}
        {% set delta_x = printer.gcode_move.position.x - printer.gcode_move.wcs_offsets[current_wcs][0] %}
        {% set delta_y = printer.gcode_move.position.y - printer.gcode_move.wcs_offsets[current_wcs][1] %}
        {% set delta_z = printer.gcode_move.position.z - printer.gcode_move.wcs_offsets[current_wcs][2] %}
        G10 L2 P{adjust_wcs + 1} X{offsets[0] - delta_x + params.X|float} Y{offsets[1] - delta_z + params.Z|float} Z{offsets[2] - delta_y + params.Y|float}
    {% endif %}
    SET_WCS WCS={current_wcs}
    G10 L20 X{params.X} Y{params.Y} Z{params.Z}
    G54