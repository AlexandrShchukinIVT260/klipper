[save_variables]
filename: ~/klipper/vars.cfg

[delayed_gcode LOAD_VARIABLES]
initial_duration: 1.0
gcode:
    {% set svv = printer.save_variables.variables %}
    {% set z_offset = svv.z_offset|default(0.0) %}
    {% set a_offset = svv.a_offset|default(0.0) %}
    SET_GCODE_OFFSET Z={z_offset} A={a_offset}
    {% for wcs in range(1, 6) %}
        {% set wcs_x = "wcs_x" %}
        {% set wcs_y = "wcs_y" %}
        {% set wcs_z = "wcs_z" %}
        G10 L2 P{wcs} X{svv[wcs_x ~ wcs]|default(0.0)} Y{svv[wcs_y ~ wcs]|default(0.0)} Z{svv[wcs_z ~ wcs]|default(0.0)}
    {% endfor %}

[gcode_macro SAVE_VARIABLES]
gcode:
    SAVE_VARIABLE VARIABLE=z_offset VALUE={printer.gcode_move.homing_origin.z}
    SAVE_VARIABLE VARIABLE=a_offset VALUE={printer.gcode_move.homing_origin.a}
    {% for wcs in range(6) %}
        SAVE_VARIABLE VARIABLE=wcs_x{wcs} VALUE={printer.gcode_move.wcs_offsets[wcs][0]}
        SAVE_VARIABLE VARIABLE=wcs_y{wcs} VALUE={printer.gcode_move.wcs_offsets[wcs][1]}
        SAVE_VARIABLE VARIABLE=wcs_z{wcs} VALUE={printer.gcode_move.wcs_offsets[wcs][2]}
    {% endfor %}
