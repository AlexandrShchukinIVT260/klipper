[mcu]
serial: /dev/ttyACM0

[virtual_sdcard]
path: /home/ste/uploads

[display_status]

[include stereotech_config/kinematics_300.cfg]

[include stereotech_config/chamber.cfg]

[include stereotech_config/printhead.cfg]

[include stereotech_config/main_extruder.cfg]
[include stereotech_config/second_extruder.cfg]
[include stereotech_config/nozzle_offset.cfg]

[include stereotech_config/module_3d_300.cfg]
[include stereotech_config/module_5d_300.cfg]

[include stereotech_config/print_macros.cfg]
[include stereotech_config/variables.cfg]

[probe]
pin: !P1.26
samples: 3
samples_tolerance_retries: 1
x_offset: -47.0
y_offset: -45.0
z_offset: 0.0

[bed_mesh]
speed: 120
horizontal_move_z: 20
mesh_min: 20, 20
mesh_max: 261, 253
probe_count: 5, 5

[bed_mesh module_3d]
version = 1
points =
	  0.0, 0.0, 0.0, 0.0, 0.0
	  0.0, 0.0, 0.0, 0.0, 0.0
	  0.0, 0.0, 0.0, 0.0, 0.0
	  0.0, 0.0, 0.0, 0.0, 0.0
	  0.0, 0.0, 0.0, 0.0, 0.0
x_count = 5
y_count = 5
mesh_x_pps = 2
mesh_y_pps = 2
algo = lagrange
tension = 0.2
min_x = 10.0
max_x = 261.0
min_y = 10.0
max_y = 253.0

[gcode_macro TEST_PROBE]
gcode:
    QUERY_PROBE
    UPDATE_DELAYED_GCODE ID=test_probe_loop DURATION=1.0

[gcode_macro CANCEL_TEST_PROBE]
gcode:
    UPDATE_DELAYED_GCODE ID=test_probe_loop DURATION=0.0
    {action_respond_info('Abort check loop')}

[delayed_gcode test_probe_loop]
gcode:
    {% if printer["probe"].last_query %}
        UPDATE_DELAYED_GCODE ID=test_probe_loop DURATION=0.0
        {action_respond_info('Probe pressed, abort check loop')}
    {% else %}
        {action_respond_info('Probe not pressed')}
        QUERY_PROBE
        UPDATE_DELAYED_GCODE ID=test_probe_loop DURATION=1.0
    {% endif %}

[gcode_macro CALIBRATE_MODULE_THREE_D]
description: 3D module calibration
gcode:
    {% if printer["gcode_button five_axis_module"].state == "RELEASED" %}
        G0 X197 Y195
        PROBE
        G91
        G0 Z30 F600
        G90
        MODULE_THREE_D_MESH_CALIBRATE
    {% endif %}

[gcode_macro MODULE_THREE_D_MESH_CALIBRATE]
description: 3D module calibration
gcode:
    {% if printer["gcode_button five_axis_module"].state == "RELEASED" %}
        Z_OFFSET_APPLY_PROBE Z={printer.probe.last_result[2]}
        BED_MESH_CALIBRATE PROFILE=module_3d
        BED_MESH_CLEAR
    {% endif %}

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [homing_offsets]
#*# z = 0.0
#*# a = 0.0
#*#
#*# [wcs_1]
#*# x = 0.0
#*# y = 0.0
#*# z = 0.0
#*#
#*# [wcs_2]
#*# x = 0.0
#*# y = 0.0
#*# z = 0.0
#*#
#*# [wcs_3]
#*# x = 0.0
#*# y = 0.0
#*# z = 0.0
#*#
#*# [wcs_4]
#*# x = 0.0
#*# y = 0.0
#*# z = 0.0
#*#
#*# [wcs_5]
#*# x = 0.0
#*# y = 0.0
#*# z = 0.0

